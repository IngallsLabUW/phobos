**********Overall Questions**********

Functions are less flexible, and exist in script form rather than package form (or sourced file form) due to time restraints. If we want to change that setup, some functions will need to be checked and made applicable to all confidence levels. They currently can't live outside their script.

We might want to reconsider the voltages and those interact with the matching, particularly after confidence level1 (?). They are still creating big row explosions like before and slowing stuff down in general.

Acquiring the external stuff is going to take some work.

**********Set up data**********

In order to ensure that the MS2 (and MS1, rt, etc.) matching is accurate, we need to be comparing known data before we compare unknowns.
Horai et al. 2010 recommends taking a consensus of MS2 data for comparison, as reproducibility of MS2 data is notoriously difficult.

Therefore, we ran all of the Ingalls Standards 5 times (thanks Laura) and obtained five sets of MS2 data for each compound.
We then took a consensus of four of the runs to create "theoretical data"; i.e, something to compare the fifth run to for accuracy.
Because the fifth run is being compared to very similar runs, that removes variation that might interfere with comparisons.

Taking a consensus of the MS2 data:
- The data is scaled to an intensity of 100 and all intensities below 0.5 are removed.
- Fragments are grouped exclusively on mz, and assigned a group number for those that fall within a user-defined ppm range.
- Find clusters that are robust across files using hierarchical clustering in mz space, and cut the tree at a height that produces
  the most groups with 5 +/-1 fragments, or 10 +/- fragments to account for "superimposed lollipops" (ask Will).


**********Confidence Level 1**********
Requires a good match on MS1, MS2, RT, column, z to a known chemical standard.

Tidy and setup
- Make sure all inputs (experimental and theoretical) are in a standardized format.

Process
- Apply comparison function to each row (each compound @ each voltage) of the experimetnal data frame.
- Filter the potential matches on m/z by user-defined ppm error.
- Match polarity and column.
- Rowwise:
  MS1 (m/z) and retention time (RT) Similarity Scores: exp(-0.5 * (((experimental value - theoretical value) / user-defined flexibility) ^ 2))
  MS2 cosine similarity. If both sets of MS2 values are present, calculate the similarity using the 2015 MSDial paper similarity equations.
  Total Similarity Score, according to which other similarity scores are present, also taken from 2015 MSDial paper.


**********Confidence Level 2: MoNA**********
Requires a good MS1, MS2, and z match to external database.

Download the MoNA positive and negative spectra from the website. It will need to be changed from JSON to flat file. All the original code, downloads, and modified downloads are in the MARS project repository, located on the Ingalls Github.

Tidy and setup
- Make sure all inputs (experimental and theoretical) are in a standardized format.

Process
- Apply comparison function to each row (each compound @ each voltage) of the experimental data frame.
- Filter the potential matches on m/z by user-defined ppm error.
- Match polarity and column.
- Rowwise:
  MS1 (m/z) Similarity Score: exp(-0.5 * (((experimental value - theoretical value) / user-defined flexibility) ^ 2))
  MS2 cosine similarity. If both sets of MS2 values are present, calculate the similarity using the 2015 MSDial paper similarity equations.
  Total Similarity Score, according to which other similarity scores are present, also taken from 2015 MSDial paper.



**********Confidence Level 3: MoNA**********

This step is the same as level 2, except that we match only on MS1 and z.


**********Confidence Level 3: KEGG**********

There is code to access KEGG, but like the MoNA code, it is out of date. All the relevant info is also on the MARS Github, or on the Ingalls Google Drive under collaborative projects --> MARS.

The comparison process is the same as Confidence Level 3, MoNA.


**********Confidence Level 4 breakdown**********

Literally everything else. Maybe 4 should have some kind of consistency or metrics rather than "literally everything else"


